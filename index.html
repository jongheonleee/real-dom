<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>DOM ë™ì‘ ì›ë¦¬ í•™ìŠµ</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Noto Sans KR', sans-serif; padding: 20px; background: #f5f5f5; }
    h1 { color: #333; }
    h2 { color: #555; margin-top: 30px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }

    .demo-section { background: white; padding: 20px; border-radius: 8px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

    /* ì´ë²¤íŠ¸ ë°ëª¨ìš© */
    .event-demo { display: flex; gap: 40px; align-items: flex-start; }
    .nested-boxes { flex: 1; }
    .box {
      padding: 20px;
      border: 3px solid;
      border-radius: 8px;
      transition: all 0.2s;
    }
    .box-outer {
      background: #ffebee;
      border-color: #e53935;
    }
    .box-middle {
      background: #fff3e0;
      border-color: #fb8c00;
      margin-top: 15px;
    }
    .box-inner {
      background: #e3f2fd;
      border-color: #1e88e5;
      margin-top: 15px;
      cursor: pointer;
    }
    .box.highlight {
      transform: scale(1.02);
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
    }

    .event-log {
      flex: 1;
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 8px;
      font-family: 'Consolas', monospace;
      font-size: 13px;
      min-height: 300px;
      max-height: 400px;
      overflow-y: auto;
    }
    .log-entry { margin: 3px 0; }
    .log-capture { color: #4fc3f7; }
    .log-target { color: #81c784; font-weight: bold; }
    .log-bubble { color: #ffb74d; }

    /* íŠ¸ë¦¬ êµ¬ì¡° ì‹œê°í™” */
    .tree { margin: 20px 0; }
    .tree-node {
      padding: 8px 12px;
      background: #e8f5e9;
      border: 2px solid #4caf50;
      border-radius: 4px;
      display: inline-block;
      margin: 5px;
    }
    .tree-children {
      margin-left: 30px;
      padding-left: 20px;
      border-left: 2px dashed #aaa;
    }

    /* ìƒì† ê³„ì¸µ */
    .inheritance-diagram {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }
    .class-box {
      padding: 15px 30px;
      border-radius: 8px;
      font-weight: bold;
      text-align: center;
      min-width: 200px;
    }
    .class-eventtarget { background: #e1bee7; border: 2px solid #9c27b0; }
    .class-node { background: #bbdefb; border: 2px solid #1976d2; }
    .class-element { background: #c8e6c9; border: 2px solid #388e3c; }
    .class-text { background: #ffe0b2; border: 2px solid #f57c00; }
    .class-document { background: #f8bbd0; border: 2px solid #c2185b; }
    .arrow { font-size: 24px; color: #666; }

    code { background: #f5f5f5; padding: 2px 6px; border-radius: 3px; font-family: 'Consolas', monospace; }
    pre { background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 8px; overflow-x: auto; }
    .keyword { color: #569cd6; }
    .string { color: #ce9178; }
    .comment { color: #6a9955; }

    button { padding: 8px 16px; margin: 5px; cursor: pointer; border-radius: 4px; border: none; background: #1976d2; color: white; }
    button:hover { background: #1565c0; }
  </style>
</head>
<body>
  <h1>DOM ë™ì‘ ì›ë¦¬ í•™ìŠµ</h1>

  <!-- 1. ìƒì† ê³„ì¸µ -->
  <div class="demo-section">
    <h2>1. DOM í´ë˜ìŠ¤ ìƒì† ê³„ì¸µ</h2>
    <p>DOMì€ OOPì˜ ìƒì†ì„ í™œìš©í•œ ê³„ì¸µ êµ¬ì¡°ì…ë‹ˆë‹¤. ëª¨ë“  ê²ƒì€ <code>EventTarget</code>ì—ì„œ ì‹œì‘í•©ë‹ˆë‹¤.</p>

    <div class="inheritance-diagram">
      <div class="class-box class-eventtarget">
        EventTarget<br>
        <small>addEventListener, dispatchEvent</small>
      </div>
      <div class="arrow">â†“</div>
      <div class="class-box class-node">
        Node<br>
        <small>parentNode, childNodes, appendChild</small>
      </div>
      <div class="arrow">â†“</div>
      <div style="display: flex; gap: 20px;">
        <div class="class-box class-element">
          Element<br>
          <small>tagName, attributes, querySelector</small>
        </div>
        <div class="class-box class-text">
          Text<br>
          <small>data (í…ìŠ¤íŠ¸ ë‚´ìš©)</small>
        </div>
        <div class="class-box class-document">
          Document<br>
          <small>createElement, getElementById</small>
        </div>
      </div>
    </div>
  </div>

  <!-- 2. ì´ë²¤íŠ¸ ì „íŒŒ -->
  <div class="demo-section">
    <h2>2. ì´ë²¤íŠ¸ ì „íŒŒ (Capturing â†’ Target â†’ Bubbling)</h2>
    <p>íŒŒë€ ë°•ìŠ¤(INNER)ë¥¼ í´ë¦­í•˜ë©´ ì´ë²¤íŠ¸ê°€ 3ë‹¨ê³„ë¡œ ì „íŒŒë©ë‹ˆë‹¤.</p>

    <div class="event-demo">
      <div class="nested-boxes">
        <div id="outer" class="box box-outer">
          <strong>OUTER (div)</strong> - Capturing ë¨¼ì €, Bubbling ë‚˜ì¤‘
          <div id="middle" class="box box-middle">
            <strong>MIDDLE (div)</strong>
            <div id="inner" class="box box-inner">
              <strong>INNER (div)</strong> - í´ë¦­í•˜ì„¸ìš”!
            </div>
          </div>
        </div>

        <div style="margin-top: 15px;">
          <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
          <label><input type="checkbox" id="stopProp"> stopPropagation í™œì„±í™”</label>
        </div>
      </div>

      <div class="event-log" id="eventLog">
        <div style="color: #888;">í´ë¦­ ì´ë²¤íŠ¸ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
      </div>
    </div>
  </div>

  <!-- 3. íŠ¸ë¦¬ êµ¬ì¡° -->
  <div class="demo-section">
    <h2>3. DOM íŠ¸ë¦¬ êµ¬ì¡°</h2>
    <p>DOMì€ íŠ¸ë¦¬ ìë£Œêµ¬ì¡°ì…ë‹ˆë‹¤. ê° ë…¸ë“œëŠ” <code>parentNode</code>, <code>childNodes</code>, <code>nextSibling</code> ë“±ìœ¼ë¡œ ì—°ê²°ë©ë‹ˆë‹¤.</p>

    <div id="treeVisualization" class="tree"></div>

    <pre><code><span class="comment">// íŠ¸ë¦¬ íƒìƒ‰ ì˜ˆì‹œ</span>
element.<span class="keyword">parentNode</span>        <span class="comment">// ë¶€ëª¨ ë…¸ë“œ</span>
element.<span class="keyword">childNodes</span>        <span class="comment">// ìì‹ ë…¸ë“œ ë°°ì—´</span>
element.<span class="keyword">firstChild</span>        <span class="comment">// ì²« ë²ˆì§¸ ìì‹</span>
element.<span class="keyword">lastChild</span>         <span class="comment">// ë§ˆì§€ë§‰ ìì‹</span>
element.<span class="keyword">nextSibling</span>       <span class="comment">// ë‹¤ìŒ í˜•ì œ</span>
element.<span class="keyword">previousSibling</span>   <span class="comment">// ì´ì „ í˜•ì œ</span></code></pre>
  </div>

  <!-- 4. ìš”ì†Œ ê²€ìƒ‰ -->
  <div class="demo-section">
    <h2>4. ìš”ì†Œ ê²€ìƒ‰ ë©”ì„œë“œ</h2>

    <div style="display: flex; gap: 20px;">
      <div style="flex: 1;">
        <h3>ë‹¨ì¼ ìš”ì†Œ ë°˜í™˜</h3>
        <pre><code>document.<span class="keyword">getElementById</span>(<span class="string">'id'</span>)
document.<span class="keyword">querySelector</span>(<span class="string">'.class'</span>)
element.<span class="keyword">closest</span>(<span class="string">'selector'</span>)</code></pre>
      </div>
      <div style="flex: 1;">
        <h3>ì»¬ë ‰ì…˜ ë°˜í™˜</h3>
        <pre><code>document.<span class="keyword">getElementsByTagName</span>(<span class="string">'div'</span>)
document.<span class="keyword">getElementsByClassName</span>(<span class="string">'class'</span>)
document.<span class="keyword">querySelectorAll</span>(<span class="string">'div.class'</span>)</code></pre>
      </div>
    </div>

    <p><strong>í•µì‹¬:</strong> <code>querySelector</code>ëŠ” CSS ì…€ë ‰í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¸ë¦¬ë¥¼ DFS(ê¹Šì´ ìš°ì„  íƒìƒ‰)í•©ë‹ˆë‹¤.</p>
  </div>

  <!-- 5. ë…¸ë“œ ì¡°ì‘ -->
  <div class="demo-section">
    <h2>5. ë…¸ë“œ ì¡°ì‘ (CRUD)</h2>

    <pre><code><span class="comment">// ìƒì„± (Create)</span>
const div = document.<span class="keyword">createElement</span>(<span class="string">'div'</span>);
const text = document.<span class="keyword">createTextNode</span>(<span class="string">'Hello'</span>);

<span class="comment">// ì¶”ê°€ (Append)</span>
parent.<span class="keyword">appendChild</span>(child);
parent.<span class="keyword">insertBefore</span>(newNode, referenceNode);

<span class="comment">// ì‚­ì œ (Delete)</span>
parent.<span class="keyword">removeChild</span>(child);

<span class="comment">// êµì²´ (Update)</span>
parent.<span class="keyword">replaceChild</span>(newChild, oldChild);

<span class="comment">// ë³µì œ (Clone)</span>
const clone = node.<span class="keyword">cloneNode</span>(true);  <span class="comment">// deep clone</span></code></pre>

    <p><strong>í•µì‹¬:</strong> ë…¸ë“œëŠ” í•˜ë‚˜ì˜ ë¶€ëª¨ë§Œ ê°€ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ê³³ì— <code>appendChild</code>í•˜ë©´ ì›ë˜ ìœ„ì¹˜ì—ì„œ ì œê±°ë©ë‹ˆë‹¤.</p>
  </div>

  <script>
    // ì´ë²¤íŠ¸ ë¡œê¹…
    const eventLog = document.getElementById('eventLog');
    const outer = document.getElementById('outer');
    const middle = document.getElementById('middle');
    const inner = document.getElementById('inner');

    function log(phase, element, event) {
      const phaseNames = { 1: 'CAPTURING', 2: 'AT_TARGET', 3: 'BUBBLING' };
      const phaseClasses = { 1: 'log-capture', 2: 'log-target', 3: 'log-bubble' };

      const entry = document.createElement('div');
      entry.className = `log-entry ${phaseClasses[event.eventPhase]}`;
      entry.textContent = `[${phaseNames[event.eventPhase]}] ${element.id.toUpperCase()} - target: ${event.target.id}, currentTarget: ${event.currentTarget.id}`;
      eventLog.appendChild(entry);
      eventLog.scrollTop = eventLog.scrollHeight;

      // í•˜ì´ë¼ì´íŠ¸
      element.classList.add('highlight');
      setTimeout(() => element.classList.remove('highlight'), 200);
    }

    function clearLog() {
      eventLog.innerHTML = '<div style="color: #888;">ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤. ë‹¤ì‹œ í´ë¦­í•˜ì„¸ìš”...</div>';
    }

    // Capturing ë¦¬ìŠ¤ë„ˆ (ì„¸ ë²ˆì§¸ ì¸ì true)
    outer.addEventListener('click', (e) => log('CAPTURING', outer, e), true);
    middle.addEventListener('click', (e) => log('CAPTURING', middle, e), true);
    inner.addEventListener('click', (e) => log('CAPTURING', inner, e), true);

    // Bubbling ë¦¬ìŠ¤ë„ˆ (ê¸°ë³¸ê°’)
    outer.addEventListener('click', (e) => log('BUBBLING', outer, e));
    middle.addEventListener('click', (e) => log('BUBBLING', middle, e));
    inner.addEventListener('click', (e) => {
      log('BUBBLING', inner, e);
      if (document.getElementById('stopProp').checked) {
        e.stopPropagation();
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.style.color = '#f44336';
        entry.textContent = 'ğŸ›‘ stopPropagation() í˜¸ì¶œë¨ - ë²„ë¸”ë§ ì¤‘ë‹¨!';
        eventLog.appendChild(entry);
      }
    });

    // íŠ¸ë¦¬ ì‹œê°í™”
    function visualizeTree(element, container) {
      const nodeDiv = document.createElement('div');

      const nodeBox = document.createElement('span');
      nodeBox.className = 'tree-node';
      nodeBox.textContent = element.tagName || element.nodeName;
      if (element.id) nodeBox.textContent += `#${element.id}`;
      nodeDiv.appendChild(nodeBox);

      if (element.children && element.children.length > 0) {
        const childrenDiv = document.createElement('div');
        childrenDiv.className = 'tree-children';

        for (const child of element.children) {
          visualizeTree(child, childrenDiv);
        }
        nodeDiv.appendChild(childrenDiv);
      }

      container.appendChild(nodeDiv);
    }

    // bodyì˜ ì²« ë²ˆì§¸ ì„¹ì…˜ë§Œ ì‹œê°í™”
    visualizeTree(document.querySelector('.demo-section'), document.getElementById('treeVisualization'));
  </script>

  <script src="mini-dom.js"></script>
</body>
</html>
